(()=>{"use strict";const e=window.wp.i18n,t=window.wp.blocks,n=window.React,r=window.wp.blockEditor,o=window.wp.data,a=window.wp.element,l=window.wp.components,c=()=>(0,n.createElement)(l.SVG,{width:"29",height:"29",viewBox:"0 0 29 29",xmlns:"http://www.w3.org/2000/svg"},(0,n.createElement)(l.Rect,{width:"29",height:"29",fill:"white"}),(0,n.createElement)(l.Circle,{cx:"14.5",cy:"14.5",r:"14",stroke:"black",fill:"white"}),(0,n.createElement)(l.Path,{d:"M19.9726 11.1289V13.2651H17.8516V11.1289H19.9726ZM19.9726 18.8847V20.9994H17.8516V18.8847H19.9726Z",fill:"black"}),(0,n.createElement)(l.Path,{d:"M12.9683 7V11.1315H15.9261V12.7762H12.9683V17.7105C12.9683 18.7678 13.5439 19.3552 14.5166 19.3552H15.9261V21H14.3578C12.333 21 11.0427 19.786 11.0427 17.7692V12.7762H8.99805V11.1315H11.0427V7H12.9683Z",fill:"black"})),i=({title:e="Teachable Buy Button",description:t="This block is encountering an unexpected error. Please try resolving it by resetting your API Key in the plugin settings."})=>(0,n.createElement)("div",{className:"teachable-error-notice"},(0,n.createElement)(c,null),(0,n.createElement)("h5",{className:"teachable-error-title"},e),(0,n.createElement)("p",{className:"teachable-error-description"},t)),u=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":2,"name":"teachable/product-checkout-button","title":"Product Checkout Button","category":"embed","description":"A teachable product checkout button block.","keywords":["teachable product checkout button"],"version":"1.0.0","textdomain":"teachable","usesContext":["teachableBuyButton/productId"],"ancestor":["teachable/buy-button"],"example":{},"attributes":{"productId":{"type":"string","default":null},"buttonText":{"type":"string","default":"Buy now"},"urlQuery":{"type":"string","default":""}},"supports":{"color":{"text":true,"background":true,"border":true},"typography":{"fontSize":true,"lineHeight":true,"fontStyle":true,"fontWeight":true,"textTransform":true,"fontFamily":true},"dimensions":{"aspectRatio":true,"minHeight":true},"spacing":{"margin":true,"padding":true},"__experimentalBorder":{"radius":true,"color":true,"style":true,"width":true},"align":true},"editorScript":"file:./index.js","render":"file:./render.php"}'),{name:s}=u,d={...u,title:(0,e.__)("Teachable Checkout Button","teachable"),description:(0,e.__)("A teachable product checkout button block.","teachable"),icon:"money-alt",edit:function(t){const{attributes:c,clientId:u,setAttributes:s}=t,{productId:d,buttonText:h,urlQuery:b}=c,{buyButtonData:p,description_classes:m}=teachable_buy_button||{},g=!1===p?[]:p,y=Array.isArray(g)?g.map((({id:e,name:t})=>({value:e.toString(),label:t.trim()}))):[],f=e=>{const t=g.some((t=>t.id.toString()===e));return!t&&g.length>0?g[0].id.toString():e};(0,a.useEffect)((()=>{s({productId:f(d)})}),[d]);const w=d?g.find((e=>e.id.toString()===f(d))):g.find((e=>e.id.toString()===(y.length>0?y[0].value:null))),[_,k]=(0,a.useState)(w),[E,x]=(0,a.useState)(null),[B,S]=(0,a.useState)(!0);(0,a.useEffect)((()=>{s(B&&d?{productId:d}:{productId:E}),S(!1)}),[B,E,x]);const v=(0,o.useSelect)((e=>{let t=u;for(;t;){const n=e("core/block-editor").getBlockRootClientId(t);if(!n)break;const r=e("core/block-editor").getBlockAttributes(n);if(r&&r.productId)return r.productId;t=n}if(Array.isArray(g)){const e=g.map((({id:e,name:t})=>({value:e.toString(),label:t})));return e.length>0?e[0].value:null}return null}),[u]);(0,a.useEffect)((()=>{k((e=>g.find((e=>e.id.toString()===v)))),x(f(v))}),[v]);const C=(0,r.useBlockProps)({className:`teachable-checkout-button ${m}`});return _?(0,n.createElement)(a.Fragment,null,(0,n.createElement)(r.InspectorControls,{group:"settings"},(0,n.createElement)(l.PanelBody,{title:(0,e.__)("General","teachable"),initialOpen:!0},(0,n.createElement)("div",null,(0,n.createElement)(l.ComboboxControl,{label:(0,e.__)("Product","teachable"),value:E,options:y,onChange:e=>{E&&e&&e!==E&&(k(g.find((t=>t.id.toString()===e))),x(e))},help:(0,e.__)("Select a course or bundle.","teachable")}),_&&(0,n.createElement)(a.Fragment,null,(0,n.createElement)(l.TextControl,{label:(0,e.__)("Button Text","teachable"),value:h||"",onChange:t=>s({buttonText:t||(0,e.__)("Buy now","teachable")}),help:(0,e.__)("The text to display within the button.","teachable")}),(0,n.createElement)(l.TextControl,{label:(0,e.__)("URL Parameters","teachable"),value:b||"",placeholder:(0,e.__)("&utm_id=1234","teachable"),onChange:e=>{const t=/^[a-zA-Z0-9&=_.\-~]+$/,n=e.split("").filter((e=>t.test(e))).join("");s({urlQuery:n})},help:(0,e.__)("An extension of the checkout button URL.","teachable")}))))),(0,n.createElement)("div",{...C,"data-query":b,target:"_blank",rel:"noopener noreferrer"},h)):(0,n.createElement)("div",{...C},(0,n.createElement)(i,{title:(0,e.__)("Product Checkout Button","teachable"),description:(0,e.__)("Oops! No product checkout button found. Please add one in your Teachable account, then return to WordPress and sync the data on the plugin settings page. After syncing, revisit this step.","teachable")}))},save:function(){return null}};(0,t.registerBlockType)(s,d),(0,t.registerBlockCollection)("teachable",{title:"Teachable"})})();