(()=>{"use strict";const e=window.wp.i18n,t=window.wp.blocks,a=window.React,r=window.wp.blockEditor,n=window.wp.data,l=window.wp.element,o=window.wp.components,c=()=>(0,a.createElement)(o.SVG,{width:"29",height:"29",viewBox:"0 0 29 29",xmlns:"http://www.w3.org/2000/svg"},(0,a.createElement)(o.Rect,{width:"29",height:"29",fill:"white"}),(0,a.createElement)(o.Circle,{cx:"14.5",cy:"14.5",r:"14",stroke:"black",fill:"white"}),(0,a.createElement)(o.Path,{d:"M19.9726 11.1289V13.2651H17.8516V11.1289H19.9726ZM19.9726 18.8847V20.9994H17.8516V18.8847H19.9726Z",fill:"black"}),(0,a.createElement)(o.Path,{d:"M12.9683 7V11.1315H15.9261V12.7762H12.9683V17.7105C12.9683 18.7678 13.5439 19.3552 14.5166 19.3552H15.9261V21H14.3578C12.333 21 11.0427 19.786 11.0427 17.7692V12.7762H8.99805V11.1315H11.0427V7H12.9683Z",fill:"black"})),i=({title:e="Teachable Buy Button",description:t="This block is encountering an unexpected error. Please try resolving it by resetting your API Key in the plugin settings."})=>(0,a.createElement)("div",{className:"teachable-error-notice"},(0,a.createElement)(c,null),(0,a.createElement)("h5",{className:"teachable-error-title"},e),(0,a.createElement)("p",{className:"teachable-error-description"},t)),d=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":2,"name":"teachable/product-updated-at","title":"Product Updated At","category":"embed","description":"A teachable product updated at block.","keywords":["teachable product updated at"],"version":"1.0.0","textdomain":"teachable","usesContext":["teachableBuyButton/productId"],"ancestor":["teachable/buy-button"],"example":{},"attributes":{"productId":{"type":"string","default":null}},"supports":{"color":{"text":true,"background":true,"border":true},"typography":{"fontSize":true,"lineHeight":true,"fontStyle":true,"fontWeight":true,"textTransform":true,"fontFamily":true},"dimensions":{"aspectRatio":true,"minHeight":true},"spacing":{"margin":true,"padding":true},"__experimentalBorder":{"radius":true,"color":true,"style":true,"width":true},"align":true},"editorScript":"file:./index.js","render":"file:./render.php"}'),{name:s}=d,u={...d,title:(0,e.__)("Teachable Updated At","teachable"),description:(0,e.__)("A teachable product updated at block.","teachable"),icon:"clock",edit:function(t){const{attributes:c,clientId:d,setAttributes:s}=t,{productId:u}=c,{buyButtonData:p,description_classes:h}=teachable_buy_button||{},b=!1===p?[]:p,g=Array.isArray(b)?b.map((({id:e,name:t})=>({value:e.toString(),label:t.trim()}))):[],m=e=>{const t=b.some((t=>t.id.toString()===e));return!t&&b.length>0?b[0].id.toString():e};(0,l.useEffect)((()=>{s({productId:m(u)})}),[u]);const w=u?b.find((e=>e.id.toString()===m(u))):b.find((e=>e.id.toString()===(g.length>0?g[0].value:null))),[f,y]=(0,l.useState)(w),[_,E]=(0,l.useState)(null),[k,S]=(0,l.useState)(!0);(0,l.useEffect)((()=>{s(k&&u?{productId:u}:{productId:_}),S(!1)}),[k,_,E]);const v=(0,n.useSelect)((e=>{let t=d;for(;t;){const a=e("core/block-editor").getBlockRootClientId(t);if(!a)break;const r=e("core/block-editor").getBlockAttributes(a);if(r&&r.productId)return r.productId;t=a}if(Array.isArray(b)){const e=b.map((({id:e,name:t})=>({value:e.toString(),label:t})));return e.length>0?e[0].value:null}return null}),[d]);(0,l.useEffect)((()=>{y((e=>b.find((e=>e.id.toString()===v)))),E(m(v))}),[v]);const C=(0,e.__)("Last updated","teachable"),H=(0,r.useBlockProps)({className:`teachable-updated-at ${h}`});return f&&f.updated_at&&""!==f.updated_at?(0,a.createElement)(l.Fragment,null,(0,a.createElement)(r.InspectorControls,{group:"settings"},(0,a.createElement)(o.PanelBody,{title:(0,e.__)("General","teachable"),initialOpen:!0},(0,a.createElement)("div",null,(0,a.createElement)(o.ComboboxControl,{label:(0,e.__)("Product","teachable"),value:_,options:g,onChange:e=>{_&&e&&e!==_&&(y(b.find((t=>t.id.toString()===e))),E(e))},help:(0,e.__)("Select a course or bundle.","teachable")})))),(0,a.createElement)("p",{...H},(0,a.createElement)("span",{className:"teachable-updated-at-icon",dangerouslySetInnerHTML:{__html:'<svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" style="display:block"><path d="M8 5V10L12.25 12.52L13.02 11.24L9.5 9.15V5H8ZM18 7V0L15.36 2.64C13.74 1.01 11.49 0 9 0C4.03 0 0 4.03 0 9C0 13.97 4.03 18 9 18C13.97 18 18 13.97 18 9H16C16 12.86 12.86 16 9 16C5.14 16 2 12.86 2 9C2 5.14 5.14 2 9 2C10.93 2 12.68 2.79 13.95 4.05L11 7H18Z" fill="currentColor" /></svg>'}}),(0,a.createElement)("span",{className:"teachable-updated-at-details"},C),(0,a.createElement)("span",{className:"teachable-updated-at-date"},(e=>{const t=new Date(e),a=t.getDate(),r=t.getMonth(),n=t.getFullYear();return`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][r]} ${(e=>{const t=e%10,a=e%100;return 1===t&&11!==a?e+"st":2===t&&12!==a?e+"nd":3===t&&13!==a?e+"rd":e+"th"})(a)}, ${n}`})(f.updated_at)))):(0,a.createElement)("div",{...H},(0,a.createElement)(i,{title:(0,e.__)("Product Updated At","teachable"),description:(0,e.__)("Oops! No product updated at date found. Please add one in your Teachable account, then return to WordPress and sync the data on the plugin settings page. After syncing, revisit this step.","teachable")}))},save:function(){return null}};(0,t.registerBlockType)(s,u),(0,t.registerBlockCollection)("teachable",{title:"Teachable"})})();