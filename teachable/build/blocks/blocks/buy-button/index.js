(()=>{"use strict";const e=window.React,t=window.wp.i18n,o=window.wp.blocks,c=window.wp.blockEditor,a=window.wp.element,r=window.wp.components,n=window.wp.data,l=()=>(0,e.createElement)(r.SVG,{width:"29",height:"29",viewBox:"0 0 29 29",xmlns:"http://www.w3.org/2000/svg"},(0,e.createElement)(r.Rect,{width:"29",height:"29",fill:"white"}),(0,e.createElement)(r.Circle,{cx:"14.5",cy:"14.5",r:"14",stroke:"black",fill:"white"}),(0,e.createElement)(r.Path,{d:"M19.9726 11.1289V13.2651H17.8516V11.1289H19.9726ZM19.9726 18.8847V20.9994H17.8516V18.8847H19.9726Z",fill:"black"}),(0,e.createElement)(r.Path,{d:"M12.9683 7V11.1315H15.9261V12.7762H12.9683V17.7105C12.9683 18.7678 13.5439 19.3552 14.5166 19.3552H15.9261V21H14.3578C12.333 21 11.0427 19.786 11.0427 17.7692V12.7762H8.99805V11.1315H11.0427V7H12.9683Z",fill:"black"})),i=({title:t="Teachable Buy Button",description:o="This block is encountering an unexpected error. Please try resolving it by resetting your API Key in the plugin settings."})=>(0,e.createElement)("div",{className:"teachable-error-notice"},(0,e.createElement)(l,null),(0,e.createElement)("h5",{className:"teachable-error-title"},t),(0,e.createElement)("p",{className:"teachable-error-description"},o)),u=()=>(0,e.createElement)(r.SVG,{width:"27",height:"27",viewBox:"0 0 27 27",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,e.createElement)(r.Path,{d:"M13.5 0.166504C6.13996 0.166504 0.166626 6.13984 0.166626 13.4998C0.166626 20.8598 6.13996 26.8332 13.5 26.8332C20.86 26.8332 26.8333 20.8598 26.8333 13.4998C26.8333 6.13984 20.86 0.166504 13.5 0.166504ZM14.8333 20.1665H12.1666V17.4998H14.8333V20.1665ZM14.8333 14.8332H12.1666V6.83317H14.8333V14.8332Z",fill:"#AE2D2D"})),s=()=>(0,e.createElement)("div",{className:"teachable-error-notice"},(0,e.createElement)(u,null),(0,e.createElement)("p",{className:"teachable-error-description"},"This block is no longer available. Please contact the site administrator for assistance.")),p=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":2,"name":"teachable/buy-button","title":"Teachable Buy Button","category":"embed","icon":"edit","description":"Allow customers to purchase your Teachable products from your website more easily.","keywords":["teachable buy button"],"version":"1.0.0","textdomain":"teachable","providesContext":{"teachableBuyButton/productId":"productId"},"example":{"attributes":{"productId":0}},"attributes":{"productId":{"type":"string","default":null},"hasError":{"type":"boolean","default":false}},"supports":{"color":{"text":true,"background":true,"border":true},"typography":{"fontSize":true,"lineHeight":true,"fontStyle":true,"fontWeight":true,"textTransform":true,"fontFamily":true},"dimensions":{"aspectRatio":true,"minHeight":true},"spacing":{"margin":true,"padding":true},"align":true},"editorScript":"file:./index.js"}'),{name:d}=p,h={...p,title:(0,t.__)("Teachable Buy Button","teachable"),description:(0,t.__)("Allow customers to purchase your Teachable products from your website more easily.","teachable"),icon:(0,e.createElement)(l,null),edit:function(l){const{attributes:u,clientId:s,setAttributes:p}=l,{productId:d}=u,{buyButtonData:h,description_classes:b}=teachable_buy_button||{},m=!1===h?[]:h,g=Array.isArray(m)?m.map((({id:e,name:t})=>({value:e.toString(),label:t.trim()}))):[],f=e=>{const t=m.some((t=>t.id.toString()===e));return!t&&m.length>0?m[0].id.toString():e};(0,a.useEffect)((()=>{p({productId:f(d)})}),[d]);const y=d?m.find((e=>e.id.toString()===f(d))):m.find((e=>e.id.toString()===(g.length>0?g[0].value:null))),[k,w]=(0,a.useState)(y),[E,B]=(0,a.useState)(null),[x,I]=(0,a.useState)(!0);(0,a.useEffect)((()=>{p(x&&d?{productId:d}:{productId:E}),I(!1)}),[x,E,B]);const S=(0,n.useSelect)((e=>{const{getBlock:t}=e("core/block-editor");return function e(o){const c=t(o);if(!c)return{};let a={};const r={"teachable/product-image":"productId","teachable/product-name":"productId","teachable/product-description":"productId","teachable/product-enrollment-count":"productId","teachable/product-updated-at":"productId","teachable/product-plan-options":"productId","teachable/product-checkout-button":"productId"};r[c.name]&&(a[c.name]=c.attributes[r[c.name]]);for(const t of c.innerBlocks){const o=e(t.clientId);a={...a,...o}}return a}(s)}),[s]),{getBlock:v,getBlocksByClientId:V}=(0,n.useSelect)((e=>e("core/block-editor"))),{updateBlockAttributes:H}=(0,n.useDispatch)("core/block-editor"),C=(e,t)=>{const o=v(e);o&&o.innerBlocks.forEach((e=>{if(["teachable/product-image","teachable/product-name","teachable/product-description","teachable/product-enrollment-count","teachable/product-updated-at","teachable/product-plan-options","teachable/product-checkout-button"].includes(e.name)&&e.attributes.productId!==t){const o={productId:t};H(e.clientId,o)}e.innerBlocks.length>0&&C(e.clientId,t)}))};(0,a.useEffect)((()=>{const e=Object.values(S).find((e=>e!==d))||null;e&&e!==d?E!==e&&(B(e),C(s,e)):E!==d&&(B(d),C(s,d))}),[S,d,s]);const _=(0,c.useBlockProps)({className:"teachable-buy-button"}),P=(0,n.useSelect)((e=>e("core/block-editor").getBlock(s).innerBlocks),[s]),{replaceInnerBlocks:N}=(0,n.useDispatch)("core/block-editor");(0,a.useEffect)((()=>{const e=function(e,t){const o={"teachable/product-plan-options":!1,"teachable/product-checkout-button":!1};return function e(c){c.forEach((c=>{t.includes(c.name)&&(o[c.name]=!0),c.innerBlocks.length&&e(c.innerBlocks)}))}(e),o}(P,["teachable/product-plan-options","teachable/product-checkout-button"]),t=[];k&&!x&&(e["teachable/product-plan-options"]||t.push((0,o.createBlock)("teachable/product-plan-options")),e["teachable/product-checkout-button"]||t.push((0,o.createBlock)("teachable/product-checkout-button"))),t.length>0&&N(s,[...P,...t],!1)}),[x,P,s,N]);const T=(0,c.useInnerBlocksProps)({},{template:[["teachable/product-image",{style:{border:{radius:"9px 9px 0 0"}}}],["core/group",{style:{padding:"16px",spacing:{padding:{top:"16px",bottom:"16px",left:"16px",right:"16px"}}}},[["teachable/product-name",{style:{typography:{fontSize:"35px"}}}],["teachable/product-description",{style:{typography:{fontSize:"17px"}}}],["core/columns",{className:"teachable-details",verticalAlignment:"center"},[["core/column",{},[["teachable/product-enrollment-count",{style:{typography:{fontSize:"15px"}}}]]],["core/column",{},[["teachable/product-updated-at",{style:{typography:{fontSize:"15px"}}}]]]]],["core/group",{className:"teachable-pricing"},[["teachable/product-plan-options"],["teachable/product-checkout-button",{style:{border:{radius:"4px"},color:{background:"#222222",text:"#ffffff"},spacing:{padding:"12px 16px 12px 16px",margin:"20px 0 0 0"},typography:{fontSize:"20px"}}}]]]]]],templateLock:!1});return(0,a.useEffect)((()=>{p({hasError:!k||k&&0===k.pricing_plans.length})}),[k,p]),(0,e.createElement)(a.Fragment,null,(0,e.createElement)(c.InspectorControls,{group:"settings"},(0,e.createElement)(r.PanelBody,{title:(0,t.__)("General","teachable"),initialOpen:!0},(0,e.createElement)("div",null,(0,e.createElement)(r.ComboboxControl,{label:(0,t.__)("Product","teachable"),value:E,options:g,onChange:e=>{E&&e&&e!==E&&(w(m.find((t=>t.id.toString()===e))),B(e),C(s,e))},help:(0,t.__)("Select a course or bundle.","teachable")})))),(0,e.createElement)("div",{..._},k&&k!==[]?(0,e.createElement)("div",{...T}):(0,e.createElement)(i,null)))},save:function(t){const{attributes:o}=t,{hasError:a}=o,r=c.useBlockProps.save({className:"teachable-buy-button"}),n=c.useInnerBlocksProps.save({},!1);return(0,e.createElement)("div",{...r},a?(0,e.createElement)(s,null):n.children)}};(0,o.registerBlockType)(d,h),(0,o.registerBlockCollection)("teachable",{title:"Teachable"})})();